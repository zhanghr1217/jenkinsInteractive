<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        html,
        body {
            height: 100%;
            padding: 0;
            margin: 0;
        }
        .lotterybox{
            height: 100%;
        }
    </style>
</head>
<body>
<div class="lotterybox">
</div>


<link rel="stylesheet" type="text/css" href="res/lottery.css" th:href="@{/static/css/lottery.css}">
<script src="https://cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script>
<script src="js/jquery.min.js" th:src="@{/static/js/jquery.min.js}"></script>
<!--<script type="text/javascript" src="res/lottery.js" th:src="@{/static/js/lottery.js}"></script>-->
<script type="text/javascript" src="res/lottery.js" th:src="@{/static/js/lottery.compact.min.js}"></script>
<script>
    var lotteryData = [];
    var courseId = "";
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }
    function init() {

        var gId = getQueryString("groupId");
        var type = getQueryString("type");
        courseId = getQueryString("courseId");
        var groupId = gId.split(",");
        $.ajax({
            type:"post",
            url:"/teacher/course/lottery/students/info",
            contentType: 'application/json',
            async:false,
            data:JSON.stringify({
                groupId:groupId
            }),
            success:function (res) {
                for (var i = 0; i < res.length; i++) {
                    var obj = {};
                    obj.name = res[i].name;
                    obj.avatar = res[i].head;
                    var data = {};
                    data.name = res[i].name;
                    data.id = res[i].id;
                    obj.data = data;
                    lotteryData.push(obj);
                }
            },
            error:function (e) {
                alert(e.statusText);
            }
        });

        $.lottery({
            el: ".lotterybox",                           // åœ¨å“ªé‡Œè¾“å‡ºæŠ½å¥–çš„domï¼Œä½¿ç”¨jqueryé€‰æ‹©å™¨
            // timeout: 10,                              // æŠ½å¥–è‡ªåŠ¨åœæ­¢æ—¶é—´ï¼ˆç§’ï¼‰
            once: type == 0,                               // æ¯äººåªèƒ½ä¸­å¥–ä¸€æ¬¡ï¼ˆé˜²æ­¢é‡å¤ä¸­å¥–ï¼‰
            title: "name",                         // ä¸­å¥–ç•Œé¢æ˜¾ç¤ºçš„æ ‡é¢˜ data[key]
            subtitle: "id",                        // ä¸­å¥–ç•Œé¢æ˜¾ç¤ºçš„å‰¯æ ‡é¢˜ data[key]
            data: lotteryData,                                 // ç›´æŽ¥ä¼ å…¥æŠ½å¥–è€…æ•°æ®
            confetti: true,                           // ä¸­å¥–æ—¶å€™æ˜¾ç¤ºå°å½©å¸¦åŠ¨ç”»
            showbtn: false,                            // æ˜¾ç¤ºæŠ½å¥–æŽ§åˆ¶æŒ‰é’®
            speed: 200,                               // éšæœºåˆ°ä¸‹ä¸€ä¸ªå‚ä¸Žè€…çš„é—´éš”æ—¶é—´ï¼Œå•ä½æ¯«ç§’
            number: 1                                 // æ¯è½®çš„ä¸­å¥–äººæ•°
        });
        var b = $(".dh-lottery");
        var c = '<div class="actions" style="display: flex; position: fixed; right: 20px; bottom: 20px;" >         <a class="button primary" id="dh-history-show"><i class="dh-icon dh-icon-dice">ðŸ’¾<svg><use xlink:href="#dh-save"></use></svg></i></a>        <a class="button primary" id="dh-lottery-go"><i class="dh-icon dh-icon-dice">ðŸŽ²<svg><use xlink:href="#dh-dice"></use></svg></i></a>    </div>';
        b.append(c);
        document.getElementById('dh-history-show').onclick=show;
        document.getElementById('dh-lottery-go').onclick=start;


    }
    init();


    function get() {
        console.log($.lottery('winners', 'get'));
    }
    function start() {

        if($("#dh-lottery-go").attr('class').indexOf("success")!=-1){
            stop();
        }else {
            $.lottery('start');
        }
    }
    function stop() {
        $.lottery('stop');
        var obj = $.lottery('winners', 'get');
        var obj2 = [];
        console.log(obj);
        for (var i = 0; i < obj.length; i++) {
            if(typeof(obj[i]) != "undefined"){
                obj2.push(obj[i].data.id);
            }
        }
        $.ajax({
            type:"post",
            contentType: 'application/json',
            url:"/teacher/course/lottery",
            data:JSON.stringify({
                courseId:courseId,
                studentIds:obj2
            }),
            success:function (res) {

            },
            error:function (e) {

            }
        })
    }
    function show() {
        $.lottery('history', 'show');
    }
</script>
</body>
</html>